(function(p){function q(a){var b=0;if("[object HTML"!==Object.prototype.toString.call(a).substring(0,12))return b;var b=h(a,function(a,b){return 0<a&&-1!==b.className.indexOf(f+"-item")?!1:!0}),c=b.querySelector("."+f+"-list");a=c.firstChild;a||(a=g("test"),c.appendChild(a));c=document.createElement("div");c.style.cssText="position:absolute;top:-9999px;max-height:1000px";c.appendChild(b);document.body.appendChild(c);b=parseInt(getComputedStyle(a).height,10);document.body.removeChild(c);return b}function h(a,
b){var c=document.createElement(a.tagName);c.className=a.className;c.style.cssText=a.style.cssText;for(var e=0,d=a.children.length;e<d;e++){var f=a.children[e];if(b&&!b(e,f))break;f=h(f,b);c.appendChild(f)}return c}function g(a){var b,c=a.text;"[object HTML"===Object.prototype.toString.call(c).substring(0,12)?b=c:(b=document.createElement("span"),b.textContent=(""+("undefined"!==typeof c?c:a)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\//g,
"&#x2F;"));a=document.createElement("li");a.className=f+"-item";a.appendChild(b);return a}function d(a,b){"[object Object]"===Object.prototype.toString.call(a)&&(b=a,a=null);b=b||{};a=a||b.items||[];Object.keys(k).forEach(function(a){"undefined"===typeof b[a]&&(b[a]=k[a])});this.items=a;this.element=null;this.selectedIndex=-1;this.selectedItem=null;this._config=b;this._max=this._min=this._itemHeight=0;this._pressed=!1;this._scrollOverflow=this._offset=this._reference=0}var k={viewSize:2,itemHeight:""},
f="touch-select",l="transform",m="wheel",r="undefined"!==typeof window.ontouchstart,n=document.createElement("div");"onwheel"in n||(m="mousewheel");["webkit","Moz","O","ms"].every(function(a){a+="Transform";return"undefined"!==typeof n.style[a]?(l=a,!1):!0});Object.defineProperty(d.prototype,"length",{get:function(){return this.items.length}});d.prototype.build=function(){var a=document.createElement("div");a.className=f;var b=document.createElement("div");b.className=f+"-inner";a.appendChild(b);
var c=document.createElement("ol");c.className=f+"-list";b.appendChild(c);var e=document.createElement("div");e.className=f+"-indicator";b.appendChild(e);this.items.forEach(function(a){c.appendChild(g(a))},this);r&&b.addEventListener("touchstart",this._tap.bind(this),!1);b.addEventListener("mousedown",this._tap.bind(this),!1);b.addEventListener(m,this._wheel.bind(this),!1);this.element=a;this.resize();this.select(0);return this.element};d.prototype.resize=function(){if(this.element){var a=this._config.itemHeight||
q(this.element);this._itemHeight=a;this._scrollOverflow=this._itemHeight/4;var b=this._config.viewSize,c=Math.ceil(b),e=0===c%2?1:0,c=(c-b+e)*a,b=Math.floor(b)-e;this._min=Math.floor(-b*a/2+a/2-c/2);this._max=(this.items.length-1)*a+this._min;this.element.querySelector("."+f+"-list").style.height=b*a+c+"px";e=this.element.querySelector("."+f+"-indicator");e.style.height=a+"px";e.style.top=b/2*a+c/2-a/2+"px"}};d.prototype.remove=function(a){if(!isNaN(a)&&this.element&&0!==this.items.length){var b=
this.element.querySelector(".touch-select-list");if(b&&b.children.length>a&&this.items.length>a){var c=a;c===this.items.length-1&&--c;b.removeChild(b.children[a]);b=this.items.splice(a,1);this.resize();c<a&&this._scrollToIndex(c);this._fireChange();return b}}};d.prototype.add=function(a,b){if(this.element){"undefined"===typeof b&&(b=this.items.length);var c=g(a),e=this.element.querySelector(".touch-select-list");if(e)return b<this.items.length?(e.insertBefore(c,e.children[b]),this.items.splice(b,
0,a)):(e.appendChild(c),this.items.push(a)),this.resize(),1===this.items.length&&this._scrollToIndex(b),this._fireChange(),a}};d.prototype.select=function(a){this._scrollToIndex(a);this._selectIndex(a)};d.prototype._selectIndex=function(a){a>=this.items.length&&(a=this.items.length-1);-1>a&&(a=-1);this.selectedIndex=a;this.selectedItem=0<=a?this.items[a]:null;return a};d.prototype._startTracking=function(a){(this._dragListener||this._releaseListener)&&this._stopTracking();this._dragListener=this._drag.bind(this);
this._releaseListener=this._release.bind(this);document.addEventListener(a?"touchmove":"mousemove",this._dragListener,!1);document.addEventListener(a?"touchend":"mouseup",this._releaseListener,!1)};d.prototype._stopTracking=function(){this._dragListener&&(document.removeEventListener("mousemove",this._dragListener,!1),document.removeEventListener("touchmove",this._dragListener,!1),this._dragListener=null);this._releaseListener&&(document.removeEventListener("mouseup",this._releaseListener,!1),document.removeEventListener("touchend",
this._releaseListener,!1),this._releaseListener=null)};d.prototype._tap=function(a){a.preventDefault();a.stopPropagation();this._startTracking(a.targetTouches&&0<a.targetTouches.length);this.element.querySelector("."+f+"-inner").classList.add("dragging");this._pressed=!0;this._reference=a.targetTouches&&0<a.targetTouches.length?a.targetTouches[0].clientY:a.clientY;return!1};d.prototype._drag=function(a){a.preventDefault();a.stopPropagation();if(this._pressed){a=a.targetTouches&&0<a.targetTouches.length?
a.targetTouches[0].clientY:a.clientY;var b=this._reference-a;if(2<b||-2>b)this._reference=a,this._scroll(this._getNormOffset()+b,this._scrollOverflow)}return!1};d.prototype._release=function(a){a.preventDefault();a.stopPropagation();this._stopTracking();this.element.querySelector("."+f+"-inner").classList.remove("dragging");this._pressed=!1;this._snap(this._fireChange.bind(this));return!1};d.prototype._wheel=function(a){var b=a.deltaY;"mousewheel"===a.type?b=-.025*a.wheelDelta:"undefined"===typeof a.deltaY&&
(b=a.detail);a=0>b?-this._itemHeight:this._itemHeight;this._scroll(this._getNormOffset()+a);this._fireChange()};d.prototype._getNormOffset=function(){return this._offset-this._min};d.prototype._findSelectedIndex=function(){var a=this._getNormOffset();return 0<=a?Math.floor(a/this._itemHeight):0<this.items.length?0:-1};d.prototype._scroll=function(a,b){b=b||0;var c=a+this._min;c>this._max+b?c=this._max+b:c<this._min-b&&(c=this._min-b);this._offset=c;this.element.querySelector("."+f+"-list").style[l]=
"translateY("+-this._offset+"px)"};d.prototype._scrollToIndex=function(a){this._scroll(a*this._itemHeight)};d.prototype._snap=function(a){var b=this._itemHeight,c=this._getNormOffset()%b;if(0!=c){var e=-c;c>=b/2&&(e=b-c);this._scrollAnim(this._getNormOffset()+e,a)}else"[object Function]"===Object.prototype.toString.call(a)&&a()};d.prototype._scrollAnim=function(a,b,c){"[object Function]"===Object.prototype.toString.call(b)&&(c=b,b=null);b=b||400;var e=this._getNormOffset(),d=a-e,f=Math.ceil(b/60),
g=0,h=this;!isNaN(f)&&0<f&&0!=d&&requestAnimationFrame(function s(){g++;if(g<=f){var a=Math.ceil(d/f*g);h._scroll(e+a,h._scrollOverflow);requestAnimationFrame(s)}else"[object Function]"===Object.prototype.toString.call(c)&&c()})};d.prototype._fireChange=function(){var a=this._findSelectedIndex(),b="undefined"!==typeof this.items[a]?this.items[a]:null;if(a!==this.selectedIndex||b!==this.selectedItem){this._selectIndex(a);var a={index:a,value:this.selectedItem},c;try{c=new CustomEvent("change",{detail:a})}catch(d){c=
document.createEvent("Event"),c.detail=a,c.initEvent("change",!0,!0)}this.element.dispatchEvent(c)}};p.TouchSelect=d})(window);
